<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assessment Form</title>
</head>
<body>
    <h1>Assessment Form</h1>
    <form id="assessment-form">
        <!-- Submission ID -->
        <label for="submission_id">Submission ID:</label>
        <input type="text" id="submission_id" name="submission_id" required><br>

        <!-- Submitted At (ISO Date) -->
        <label for="submitted_at">Submitted At:</label>
        <input type="datetime-local" id="submitted_at" name="submitted_at" required><br>

        <!-- User Info -->
        <h3>User Information</h3>
        <label for="user_name">Name:</label>
        <input type="text" id="user_name" name="user_name" required><br>

        <label for="user_email">Email:</label>
        <input type="email" id="user_email" name="user_email" required><br>

        <!-- Beliefs Capabilities -->
        <h3>Beliefs and Capabilities</h3>
        <label for="beliefs_choice">Beliefs Choice:</label>
        <input type="text" id="beliefs_choice" name="beliefs_choice" required><br>

        <label for="beliefs_detail">Beliefs Detail:</label>
        <input type="text" id="beliefs_detail" name="beliefs_detail" required><br>

        <!-- Feelings Change -->
        <h3>Feelings Change</h3>
        <label for="feelings_choices">Feelings Choices (comma separated):</label>
        <input type="text" id="feelings_choices" name="feelings_choices" required><br>

        <label for="feelings_detail">Feelings Detail:</label>
        <input type="text" id="feelings_detail" name="feelings_detail" required><br>

        <!-- Strongest Skills -->
        <h3>Strongest Skills</h3>
        <label for="strongest_skills_choices">Strongest Skills Choices (comma separated):</label>
        <input type="text" id="strongest_skills_choices" name="strongest_skills_choices" required><br>

        <label for="strongest_skills_detail">Strongest Skills Detail:</label>
        <input type="text" id="strongest_skills_detail" name="strongest_skills_detail" required><br>

        <!-- Submit Button -->
        <button type="submit">Submit</button>
    </form>

    <script>
        // Handle form submission
        document.getElementById('assessment-form').addEventListener('submit', async function(event) {
            event.preventDefault(); // Prevent default form submission

            // Get form data
            const formData = new FormData(this);
            const formDataObj = {};

            // Convert FormData to an object
            formData.forEach((value, key) => {
                formDataObj[key] = value;
            });

            // Convert to the desired JSON structure
            const data = {
                submission_id: formDataObj.submission_id,
                submitted_at: formDataObj.submitted_at,
                user: {
                    name: formDataObj.user_name,
                    email: formDataObj.user_email,
                },
                assessment: {
                    beliefs_capabilities: {
                        choice: formDataObj.beliefs_choice,
                        detail: formDataObj.beliefs_detail,
                    },
                    feelings_change: {
                        choices: formDataObj.feelings_choices.split(','),
                        detail: formDataObj.feelings_detail,
                    },
                    strongest_skills: {
                        choices: formDataObj.strongest_skills_choices.split(','),
                        detail: formDataObj.strongest_skills_detail,
                    }
                }
            };

            try {
                // Send the data to your API endpoint
                const response = await fetch('/api/assessment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data), // Convert data to JSON
                });

                const result = await response.json();
                if (response.ok) {
                    alert('Assessment data successfully stored!');
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        });
    </script>
</body>
</html>
